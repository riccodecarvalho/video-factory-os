Perfeito — dá pra aproveitar **muita** inteligência desse DarkFlow (UX + fluxo mental + controles “certos”) e plugar no seu **Video Factory OS** sem perder o que você já construiu (config-first / manifest-first / checkpoints).

Abaixo está a consolidação **mais completa possível** do que aparece **nos prints + na transcrição**, e em seguida eu te entrego:

1. um **mini-PRD “DarkFlow UI Layer”** (pronto pra virar doc), e
2. um **PROMPT mestre** pra você colar no Antigravity/IDE implementar com fidelidade.

---

## 1) O que o DarkFlow está fazendo (reconstrução fiel)

### 1.1 Home = Kanban por status (pipeline visual)

O sistema opera como um **quadro Kanban** com colunas (cada coluna é um estágio do pipeline):

* **Vídeos a Fazer**
* **Gerar Roteiro**
* **Gerar Narração**
* **Gerar Vídeo**
* **Concluído**

No topo do quadro:

* navegação: **Início / Meus Vídeos / Tutoriais / Thumbs / Feedback**
* controles: **Usuários**, **Chunks**, dropdown **“Meus Cards (Padrão)”**, botão **“Meus Prompts”**
* toggle global **“Auto Vídeo”**
* CTA primário: **“+ Novo Vídeo”** (botão vermelho)

### 1.2 Card (o “job”) — estrutura e metadata mínima

Cada card mostra:

* **Título** (muitas vezes truncado)
* tags/pills:

  * **Idioma** (ex: Português)
  * **Voz** (ex: Valentino)
  * **Tipo** (ex: História Geral)
* menu **(⋮)** no card
* status/tempo: “há X minutos”
* em “Concluído” existe botão **Download**

### 1.3 Criação de vídeo (modal “Novo Vídeo”)

Ao clicar **Novo Vídeo**, abre um modal com 5 caminhos:

1. **Modelar Vídeo** (colocar URL de vídeo existente e “modelar”)
2. **Usar Modelo Salvo**
3. **Criar Vídeo Sem Modelo**
4. **Roteiro Personalizado**
5. **Gerar Apenas Vídeo** (subir áudio/imagens e gerar só o vídeo)

Na transcrição, o fluxo escolhido foi **“Criar um vídeo sem modelo”** .

### 1.4 Detalhes do Vídeo (um “drawer/página” com tabs)

Ao abrir um card, você entra em **Detalhes do Vídeo** com:

* header: título “Detalhes do Vídeo”
* um **ID curto** (ex: `c4aae883-5…`) com ícone de copiar
* botão **Modelos**
* status (ex: **Concluído**)

Tabs visíveis:

* **Informações**
* **Outline**
* **Imagens** (com contador, ex: 6)
* **Roteiro**
* **Áudios** (com contador, ex: 1)
* **Logs**

### 1.5 “Informações” = metadados + voz

Dentro de “Informações” aparecem:

**Detalhes do Conteúdo**

* **Título do vídeo**
* **Idioma**
* **Duração** (ex: “Curto (~12 min)”)
* **Tipo de História** (ex: “História Geral”)

**Produção e Voz**

* “Provider de Voz”: no print aparece **CapCut Voices**
* lista de vozes com:

  * botão **play** (preview)
  * ícone de **favorito** (estrela)
  * seleção com borda/estado de ativo
* exemplo: escolher “Valentino” na transcrição 

Também existe uma seção recolhível “**Configurações Avançadas**”.

### 1.6 “Mídia e Visual” = 3 modos de narrativa visual

No detalhe há um bloco **Mídia e Visual** → **Narrativa Visual**, com 2 grandes escolhas:

* **Manual**

  * **Upload de Imagens**
  * **Gerar Imagens com IA**
* **Automático**

  * “Gerar imagens automaticamente de acordo com o roteiro”

Na transcrição ele explica exatamente:

* Manual: “plugar minhas imagens” ou gerar com prompts personalizados 
* Dentro de “Gerar com IA” existem dois submodos:

  * **Única**: gera **uma imagem por vez** 
  * **Em lote**: cola vários prompts separados por **linha em branco** e o sistema conta/gera automático 

No **Automático**, você escolhe:

* **Quantas imagens gerar (máx. 10)** (no exemplo ele coloca **6**) 
* toggle **“Repetir imagens (Loop)”**

  * se marcado: ao chegar na última, repete até o final 
  * se desmarcado: distribui proporcionalmente no tempo do vídeo (ex: 12 min / 6 imgs ≈ 2 min cada) 

No print também existe ajuste de **tamanho/qualidade** (ex: “1K (Padrão)”) no modo gerar com IA.

### 1.7 Música, legenda e zoom = “acabamento” simples (e certeiro)

Ainda no detalhe:

* **Música de Fundo**: upload de mp3 
* **Legendas Automáticas** (toggle) 
* **Efeito de Zoom** (toggle) 

### 1.8 Execução: drag & drop + Auto Vídeo

O jeito de rodar é **arrastar o card**:

* Ele “clica em concluído” (salva config) e **arrasta para “Gerar Roteiro”** 
* Ao arrastar, o processo começa automático 
* O toggle **Auto Vídeo** controla o comportamento:

  * **ligado**: quando chega no estágio “Gerar Vídeo”, gera automaticamente, vai pra “Concluído” e é só baixar 
  * **desligado**: o card **para em “Gerar Vídeo”** e você precisa apertar **“Gerar Vídeo”** manualmente 

Ele relata a sequência rápida: roteiro → narração → gerar vídeo → renderização → concluído .

---

# 2) PRD — “DarkFlow UI Layer” para o Video Factory OS (plugar no seu System Map)

## 2.1 Objetivo

Adicionar uma camada de produto/UX inspirada no DarkFlow para:

* reduzir fricção de “criar → configurar → rodar → baixar”
* transformar pipeline em **Kanban operável** (drag & drop)
* padronizar “Detalhes do Job” com tabs e controles de acabamento.

## 2.2 Escopo

### Inclui

1. **Kanban Jobs Board** (colunas do pipeline, contadores, cards)
2. **Auto Vídeo toggle global** (comportamento do runner)
3. **Modal “Novo Vídeo”** com 5 caminhos
4. **Página/Drawer de Detalhes do Job** com tabs:

   * Informações
   * Outline
   * Imagens
   * Roteiro
   * Áudios
   * Logs
5. **Mídia e Visual** (Manual / Automático + gerar com IA única/em lote)
6. **Acabamento**: música de fundo, legendas automáticas, zoom

### Não inclui (por enquanto)

* “Modelar Vídeo” (clonar estilo via URL) implementado completo (fica stub)
* “Thumbs” e “Feedback” (apenas navegação/placeholder)
* marketplace de “chunks” avançado (apenas botão/rota)

## 2.3 Usuários e Jobs-to-be-Done

* Operador quer: criar vídeo em < 2 minutos, rodar pipeline sem abrir mil telas, baixar MP4 final.
* Creator quer: controlar voz, quantidade de imagens, loop vs proporcional, e acabamento.

## 2.4 Fluxos principais

### Fluxo A — Criar vídeo sem modelo (o “padrão DarkFlow”)

1. Home → **Novo Vídeo** → “Criar Vídeo Sem Modelo”
2. Preenche: título, idioma, duração, tipo
3. Escolhe voz
4. Mídia e Visual:

   * Automático: n imagens (<=10) + loop on/off
   * (ou) Manual: upload
   * (ou) Gerar com IA: única / lote
5. Acabamento: música mp3, legenda, zoom
6. Salvar/Concluir
7. **Arrastar card** para “Gerar Roteiro”
8. Runner executa:

   * roteiro → narração → (auto vídeo?) render
9. Concluído → Download

### Fluxo B — Auto Vídeo OFF

Igual ao A, mas:

* após narração, card para em “Gerar Vídeo”
* usuário precisa clicar “Gerar Vídeo” no card.

## 2.5 Requisitos de UI (fidelidade aos prints)

## Home / Board

* Top nav: Início / Meus Vídeos / Tutoriais / Thumbs / Feedback
* Controls bar:

  * Usuários (botão)
  * Chunks (botão)
  * dropdown “Meus Cards (Padrão)”
  * botão “Meus Prompts”
  * toggle “Auto Vídeo”
  * CTA “+ Novo Vídeo”
* Colunas com contador
* Cards com:

  * título truncado
  * pills: idioma, voz, tipo
  * menu (⋮)
  * estado (progress bar quando em execução)
  * em concluído: botão Download

## Modal “Novo Vídeo”

* 5 opções exatamente (com textos equivalentes):

  1. Modelar Vídeo (URL)
  2. Usar Modelo Salvo
  3. Criar Vídeo Sem Modelo
  4. Roteiro Personalizado
  5. Gerar Apenas Vídeo

## Detalhes do Job

* Header com:

  * “Detalhes do Vídeo”
  * Job ID curto + copy
  * botão “Modelos”
  * status “Concluído” (ou outros)
* Tabs:

  * Informações | Outline | Imagens (#) | Roteiro | Áudios (#) | Logs

### Tab: Informações

**Detalhes do Conteúdo**

* Título
* Idioma
* Duração (presets: Curto ~12min + outros)
* Tipo de História

**Produção e Voz**

* Provider (no seu caso: Azure TTS, mas UI idêntica)
* Lista de vozes (presets_voice):

  * play preview
  * favorite
  * selecionável

### Bloco: Mídia e Visual

**Narrativa Visual**

* Manual

  * Upload (contador “0/40”)
  * Gerar com IA:

    * tamanho/qualidade (ex: 1K)
    * modo: Única / Em lote
    * textarea prompt
    * botão “Gerar Imagem com IA”
* Automático

  * input “Quantas imagens gerar (máx. 10)”
  * toggle “Repetir imagens (Loop)”
  * comportamento:

    * loop ON: repete última até fim
    * loop OFF: distribui proporcionalmente na duração

### Acabamento

* Música de fundo: upload mp3 (mostrar limite)
* Toggle Legendas automáticas
* Toggle Efeito de zoom (zoom suave)

## 2.6 Requisitos de Engine (mapeamento no seu runner)

* Board status = mapeamento para `jobs.status` e/ou agregação de `job_steps`
* Arrastar card:

  * muda status
  * dispara execução do step correspondente
* Auto Vídeo:

  * se ON: runner segue até render automaticamente
  * se OFF: runner para antes do render (aguarda ação manual “Gerar Vídeo”)

## 2.7 Modelo de dados (mínimo necessário)

Adicionar/confirmar campos no `jobs` (ou `job_config`):

* `title`
* `language`
* `duration_preset` (ex: curto ~12)
* `story_type` (historia_geral etc)
* `voice_preset_id`
* `visual_mode` = manual_upload | manual_ai | automatic
* `images_count_requested` (<=10 quando automático)
* `images_loop` (bool)
* `images_quality_preset` (ex: 1k)
* `bg_music_artifact_id` (mp3)
* `captions_enabled` (bool)
* `zoom_effect_enabled` (bool)
* `auto_video_enabled` (bool global setting + snapshot por job opcional)

E em `artifacts`:

* imagens por índice (#1..#N), com flag de origem (auto / manual / ai)
* áudio narração
* música
* vídeo final

## 2.8 Critérios de aceite (checklist)

* [ ] Board com colunas e contadores
* [ ] Cards com pills idioma/voz/tipo e menu ⋮
* [ ] Drag card para “Gerar Roteiro” inicia pipeline 
* [ ] Auto Vídeo ON roda até Concluído sem intervenção 
* [ ] Auto Vídeo OFF para em “Gerar Vídeo” e exige clique 
* [ ] Visual automático: número de imagens + loop ON/OFF com comportamento proporcional 
* [ ] Manual AI: Única vs Em lote (linha em branco separa prompts) 
* [ ] Música mp3 + legenda + zoom toggles 
* [ ] Em concluído: Download disponível

---

# 3) PROMPT MESTRE para colar no Antigravity/IDE (implementação)

**Objetivo do prompt:** implementar no seu **Video Factory OS** uma camada UX “DarkFlow style” (Board + Detalhes) com fidelidade funcional.

---

## Prompt

Você é um engenheiro full-stack trabalhando no monorepo **Video Factory OS** (Next.js 14 App Router + Tailwind + shadcn/ui, SQLite + Drizzle, engine runner com executors e artifacts).
Implemente uma camada de produto inspirada no **DarkFlow** com foco em **Kanban operável + Detalhes do Job**, preservando os princípios:

* **Config-First**: nada hardcoded (prompts/vozes/presets no DB)
* **Manifest-First**: `manifest.json` é fonte da verdade do job
* **Checkpoint idempotente**: steps retomáveis sem refazer anteriores
* Render local com FFmpeg permanece como está

## 1) Criar “Jobs Board” (Kanban)

Crie uma rota/página “Início” (ou /jobs-board) com:

### 1.1 Topbar (layout)

* Tabs: Início / Meus Vídeos / Tutoriais / Thumbs / Feedback
* Controls: botões “Usuários”, “Chunks”, dropdown “Meus Cards (Padrão)”, botão “Meus Prompts”
* Toggle global “Auto Vídeo”
* CTA vermelho “+ Novo Vídeo”

### 1.2 Colunas e status

Renderize colunas (com contador):

* Vídeos a Fazer
* Gerar Roteiro
* Gerar Narração
* Gerar Vídeo
* Concluído

Cada coluna lista cards (jobs). Card deve exibir:

* título (truncado)
* pills: idioma, voz, tipo
* menu ⋮
* status/progresso quando rodando
* em Concluído: botão Download

### 1.3 Drag & Drop

Implemente drag & drop de cards entre colunas.
Regras:

* Arrastar para “Gerar Roteiro” dispara execução do pipeline (step roteiro) e atualiza UI conforme status.
* Quando concluir um step, mova automaticamente o card para a próxima coluna (roteiro→narração→gerar vídeo).
* Se Auto Vídeo estiver ON, ao chegar em “Gerar Vídeo” dispare render automaticamente e mova para “Concluído”.
* Se Auto Vídeo estiver OFF, o card para em “Gerar Vídeo” e exibe botão “Gerar Vídeo” para execução manual.

## 2) Modal “Novo Vídeo”

Ao clicar “+ Novo Vídeo”, abrir modal com 5 opções:

1. Modelar Vídeo (URL)
2. Usar Modelo Salvo
3. Criar Vídeo Sem Modelo
4. Roteiro Personalizado
5. Gerar Apenas Vídeo

Neste ciclo, implemente completo apenas “Criar Vídeo Sem Modelo”; as demais podem criar job em estado “draft” com UI stub.

## 3) Detalhes do Job (DarkFlow-style)

Ao clicar no card, abrir página/drawer “Detalhes do Vídeo” com:

* header: “Detalhes do Vídeo”, id curto com copy, botão “Modelos”, badge de status
* tabs: Informações | Outline | Imagens (contador) | Roteiro | Áudios (contador) | Logs

### 3.1 Tab Informações

* Detalhes do Conteúdo:

  * Título
  * Idioma
  * Duração (preset ex: Curto ~12min)
  * Tipo de História
* Produção e Voz:

  * provider (Azure TTS)
  * lista de vozes (presets_voice) com play preview e favorito
* Seção colapsável “Configurações Avançadas”

### 3.2 Mídia e Visual (Narrativa Visual)

Implementar os 3 modos:

**Manual**

* Upload: contador “0/40” + botão “Escolher Imagens”
* Gerar com IA:

  * qualidade/tamanho (ex: 1K padrão)
  * modo “Única” (uma por vez) e “Em lote” (prompts separados por linha em branco)
  * textarea + botão “Gerar Imagem com IA”
  * salvar imagens como artifacts numerados (#1..#N)

**Automático**

* input “Quantas imagens gerar (máx. 10)”
* toggle “Repetir imagens (Loop)”
* se loop OFF: distribuir imagens proporcionalmente no timeline pela duração do vídeo
* se loop ON: repetir última imagem até fim

### 3.3 Acabamento

* Música de Fundo: upload mp3 (artefato)
* Toggle: Legendas Automáticas
* Toggle: Efeito de Zoom (zoom suave)

## 4) Dados e persistência

* Adicionar campos necessários no schema (jobs/job_config) para suportar:

  * language, duration_preset, story_type, voice_preset_id
  * visual_mode, images_count_requested (<=10), images_loop, images_quality
  * bg_music_artifact_id, captions_enabled, zoom_effect_enabled
  * auto_video_enabled (global setting + opcional snapshot por job)
* Atualizar manifest.json para refletir essas escolhas

## 5) API e engine

* Criar endpoints server actions/API para:

  * criar job (sem modelo)
  * atualizar job config
  * iniciar step (roteiro/narração/render)
  * obter artifacts e status
* Integrar com runner existente:

  * execução por step
  * respeitar checkpoints
  * respeitar Auto Vídeo (stop before render quando OFF)

## 6) UX de feedback

* Toasters para: “Roteiro gerado”, “Transição para narração…”, “Enviando para geração”, “Renderizando…”, “Vídeo gerado!”
* Logs tab mostra logs por step

## 7) Entregáveis

* Implementação funcional end-to-end do fluxo:
  Criar Vídeo Sem Modelo → configurar → arrastar para Gerar Roteiro → pipeline → Concluído → Download
* Código seguindo padrões do projeto e shadcn/ui, sem hardcode de presets/prompts.

---