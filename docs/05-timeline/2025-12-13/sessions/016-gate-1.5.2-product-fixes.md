# üìÖ SESS√ÉO 2025-12-13 ‚Äî Gate 1.5.2: 5 Fixes de Produto ‚úÖ

**SHA:** `cbc62c5`

---

## üéØ Objetivo

Resolver 5 problemas de produto identificados ap√≥s o E2E:
1. Script Voz √önica
2. Audio Streaming
3. UI Error Visibility
4. Placeholders em Outputs
5. Documenta√ß√£o

---

## ‚úÖ O que foi Implementado

### A) Script Voz √önica

**Problema:** Script gerado tinha tags de voz m√∫ltiplas `(voz: NARRADORA)`, `(voz: ANTAGONISTA)`.

**Solu√ß√£o:** `parse_ssml` step agora limpa:
- Tags de voz: `(voz: X)`
- Pause markers: `[PAUSA]`, `[PAUSA CORTA]`
- Markdown headers: `#`, `##`, `###`
- SSML/XML tags residuais

**Arquivo:** `lib/engine/runner.ts` ‚Äî `executeStepTransform`

```typescript
let cleanScript = rawScript
  .replace(/\(voz:\s*[^)]+\)/gi, "")
  .replace(/\[PAUSA[^\]]*\]/gi, "")
  .replace(/^#{1,3}\s+/gm, "")
  // ... etc
```

### B) Audio Streaming

**Problema:** √Åudio n√£o tocava no browser (falta de Range headers).

**Solu√ß√£o:** `app/api/artifacts/[...path]/route.ts`:
- Suporte a Range requests (HTTP 206 Partial Content)
- Header `Accept-Ranges: bytes`
- C√°lculo de `Content-Range`

### C) UI Error Visibility

**Problema:** Erros de job n√£o eram vis√≠veis na UI.

**Solu√ß√£o:** `components/vf/PipelineView.tsx`:
- Mostra `lastError` para steps failed
- Expandido por default quando h√° erro

### D) Placeholders em Outputs

**Problema:** Outputs continham placeholders `{{title}}` em vez de conte√∫do real.

**Solu√ß√£o:**
1. Fixture real em espanhol: `fixtures/graciela.input.json`
2. Valida√ß√£o no E2E: falha se detectar `{{` ou `}}` em outputs

### E) Documenta√ß√£o

**Arquivo:** `docs/FLUXO-JOBS-STEPS-TABS.md`

Documenta√ß√£o completa cobrindo:
- Job inputs
- Step consumption/generation
- Artifact structure
- UI tab details
- TTS configuration
- Project rules

---

## üìù Arquivos Modificados

| Arquivo | Mudan√ßa |
|---------|---------|
| `lib/engine/runner.ts` | executeStepTransform real |
| `app/api/artifacts/[...path]/route.ts` | Range + 206 support |
| `components/vf/PipelineView.tsx` | lastError display |
| `scripts/e2e.ts` | Fixture + placeholder validation |
| `fixtures/graciela.input.json` | Input real em espanhol |
| `docs/FLUXO-JOBS-STEPS-TABS.md` | Nova documenta√ß√£o |

---

## üîó Commit

```
fix: Gate 1.5.2 - 5 fixes de produto

A) Script Voz √önica:
- parse_ssml limpa (voz:X), [PAUSA], SSML

B) Audio Streaming:
- Range headers + HTTP 206 support

C) UI Error Visibility:
- PipelineView mostra lastError

D) Placeholders:
- Fixture real + valida√ß√£o E2E

E) Documenta√ß√£o:
- docs/FLUXO-JOBS-STEPS-TABS.md
```

---

## ‚è≠Ô∏è Pr√≥ximo Gate

Gate 1.6 ‚Äî Render + Export (Stubs Reais)
