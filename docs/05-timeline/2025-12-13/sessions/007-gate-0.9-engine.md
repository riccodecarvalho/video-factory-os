# üìÖ SESS√ÉO 2025-12-13 ‚Äî Gate 0.9: Engine Integration (Manifest-First)

**SHA:** `a2ba590`

---

## üéØ Objetivo

Conectar UI de Produ√ß√£o (Jobs) ao engine real com steps stubados, respeitando o **Manifest Contract** e exibindo status, logs, manifest e artifacts na interface.

---

## üìã Prompt do Usu√°rio (Contexto Original)

> **Regras n√£o-negoci√°veis:**
> - Sem hardcode de neg√≥cio (voices, ffmpeg flags, providers, recipes etc). Tudo vem do DB.
> - Sem drift visual: usar somente os UI primitives j√° criados.
> - Manifest-first: job execution escreve/atualiza manifest versionado + snapshots + status por step.

---

## ‚úÖ O que foi Implementado

### A) Produ√ß√£o SplitView

- `/jobs` com PageHeader e SectionCards (contagens reais)
- **Job Detail** com tabs:
  - **Pipeline:** PipelineView com steps e status
  - **Logs:** LogsViewer com eventos por step
  - **Manifest:** ManifestViewer (JSON read-only com copy)
- Polling 2s para atualiza√ß√£o em tempo real
- EmptyState quando sem jobs

### B) Engine Phase 1

- `lib/engine/runner.ts` com execu√ß√£o sequencial
- Steps **stubados** (mock timing + output)
- Manifest real gerado e persistido
- Status transitions: `pending ‚Üí running ‚Üí success/failed`
- Logs por step com timestamps
- InputHash para idempot√™ncia

### C) Actions UI

- **Run job:** Inicia execu√ß√£o
- **Retry step:** Reset + restart
- **Cancel job:** Interrompe

### D) Jobs/new

- Recipes v√™m do DB
- Create job real
- Bot√£o "Criar e Executar"

### E) Componentes Criados

| Componente | Arquivo | Descri√ß√£o |
|------------|---------|-----------|
| **PipelineView** | `components/vf/PipelineView.tsx` | Visualiza√ß√£o de steps |
| **LogsViewer** | `components/vf/LogsViewer.tsx` | Eventos por step |
| **ManifestViewer** | `components/vf/ManifestViewer.tsx` | JSON viewer |

### F) shadcn Components Adicionados

```bash
npx shadcn@latest add tabs
npx shadcn@latest add scroll-area
```

---

## üìù Decis√µes T√©cnicas (ADR-007)

1. **Manifest Source of Truth:** O estado do job √© o JSON do manifest, n√£o colunas soltas.
2. **Idempot√™ncia via InputHash:** Permite retry sem duplica√ß√£o.
3. **Polling vs WebSocket:** Polling simples (2s) para MVP. WebSocket em gates futuros.
4. **Steps Stubados:** Mock timing realista para demonstrar o fluxo.

---

## üîó Commit

```
feat: Gate 0.9 - Engine Integration (Manifest-First)

A) Produ√ß√£o SplitView:
- /jobs com SectionCards (contagens reais)
- Job Detail: PipelineView + LogsViewer + ManifestViewer
- Tabs para navega√ß√£o (Pipeline/Logs/Manifest)
- Polling 2s para atualiza√ß√£o em tempo real
- EmptyState quando sem jobs

B) Engine Phase 1:
- lib/engine/runner.ts com execu√ß√£o sequencial
- Steps stubados (mock timing + output)
- Manifest real gerado e persistido
- Status transitions: pending‚Üírunning‚Üísuccess/failed
- Logs por step com timestamps
- InputHash para idempot√™ncia

C) Actions UI:
- Run job (inicia execu√ß√£o)
- Retry step (reset + restart)
- Cancel job (interrompe)

D) Jobs/new:
- Recipes v√™m do DB
- Create job real
- Criar e Executar

E) Docs:
- ADR-007: Engine Execution Model

F) UI Components (shadcn):
- tabs
- scroll-area
```

---

## ‚è≠Ô∏è Pr√≥ximo Gate

Gate 1.0 ‚Äî Admin Visibility + Project Context + Execution Map
