# üìÖ SESS√ÉO 2025-12-13 ‚Äî Gate 1.0: Admin Visibility + Project Context + Execution Map

**SHA:** `e28e857`

---

## üéØ Objetivo

Implementar **Governan√ßa Operacional via UI** para:
- Selecionar/configurar providers de forma clic√°vel
- Selecionar/configurar prompts e presets por step
- Saber "qual prompt √© consumido por quem, e faz o qu√™"
- Prever impacto de mudan√ßas
- Suportar m√∫ltiplos canais/projetos

---

## üìã Prompt do Usu√°rio (Contexto Original)

> **O buraco do Gate 0.9:**
> Hoje voc√™ consegue ver "o que aconteceu" num job (manifest/logs), mas n√£o consegue governar "o que vai acontecer" de forma clara e clic√°vel no Admin.
>
> Isso precisa virar uma camada de configura√ß√£o expl√≠cita no Admin, n√£o impl√≠cita em c√≥digo/runner.

---

## ‚úÖ O que foi Implementado

### A) DB Schema

| Tabela | Campos Principais |
|--------|-------------------|
| **projects** | id, key, name, description, created_at |
| **execution_bindings** | scope (global/project), project_id, recipe_id, step_key, slot, target_id, priority, is_active |
| **jobs.project_id** | FK para projects |

### B) Execution Map (`/admin/execution-map`)

- **Recipe selector** dropdown
- **Scope selector:** Global / Project (dropdown de projects)
- **SplitView:**
  - Esquerda: Lista de steps do recipe (step_key + label)
  - Direita: Detail do step com slots (Prompt / Provider / Presets / Validators / KB)
- **A√ß√µes por slot:**
  - "Atual em uso"
  - Bot√£o "Change" (dropdown)
  - Bot√£o "Save"
  - "Reset to Global" (se scope=project)
- Links clic√°veis para entity detail

### C) Actions Criadas

```typescript
getEffectiveConfig(recipe_id, project_id, step_key)
setBinding(binding)
resetToGlobal(binding_id)
seedDefaultBindings()
getUsedBy(entity_type, entity_id)
```

### D) Seed

- Project: **Graciela** (Verdades de Graciela)

### E) Components Adicionados

- Select (shadcn)
- Sidebar atualizada com Execution Map

---

## üìù Decis√µes T√©cnicas (ADR-008)

1. **Bindings = Fonte da Verdade:** O runner l√™ bindings, n√£o hardcode.
2. **Scope Override:** Project scope overrides global.
3. **Priority Field:** Resolve conflitos de m√∫ltiplos bindings.
4. **getEffectiveConfig:** Fun√ß√£o centralizada para resolver config efetiva.

---

## üîó Commit

```
feat: Gate 1.0 - Admin Visibility + Project Context + Execution Map

A) DB Schema:
- projects table (id, key, name, description)
- execution_bindings table (scope, recipe_id, step_key, slot, target_id)
- jobs.project_id FK

B) Execution Map (/admin/execution-map):
- Recipe selector + Scope selector (Global/Project)
- SplitView: Steps (left) + Slots detail (right)
- Slots: prompt, provider, preset_voice, preset_ssml, validators, kb
- Change/Save/Reset to Global actions
- Seed Bindings button

C) Actions:
- getEffectiveConfig - resolve bindings (project > global)
- setBinding - create/update binding
- resetToGlobal - remove project override
- seedDefaultBindings - initial wiring
- getUsedBy - rastreamento reverso

D) Seed:
- Project: Graciela (Verdades de Graciela)

E) Components:
- Select (shadcn)
- Sidebar updated with Execution Map

F) Docs:
- ADR-008: Project Context + Execution Bindings
```

---

## ‚è≠Ô∏è Pr√≥ximo Gate

Gate 1.1 ‚Äî Hardening + Effective Config
